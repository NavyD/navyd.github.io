<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>sudo on navyd的个人博客</title><link>https://blog.navyd.xyz/tags/sudo/</link><description>Recent content in sudo on navyd的个人博客</description><generator>Hugo -- gohugo.io</generator><language>zh-cn</language><lastBuildDate>Wed, 15 Sep 2021 13:34:37 +0800</lastBuildDate><atom:link href="https://blog.navyd.xyz/tags/sudo/index.xml" rel="self" type="application/rss+xml"/><item><title>使用root权限运行cargo test</title><link>https://blog.navyd.xyz/post/2021/09/15/cargo-test-with-root-privilege/</link><pubDate>Wed, 15 Sep 2021 13:34:37 +0800</pubDate><guid>https://blog.navyd.xyz/post/2021/09/15/cargo-test-with-root-privilege/</guid><description>&lt;p>在一些系统应用中需要访问root权限的资源，直接运行可能出现权限错误：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">$ cargo &lt;span class="nb">test&lt;/span> --package docker-clash --lib -- cli::tests::test_clean --exact --nocapture
&lt;span class="o">[&lt;/span>2021-09-15T05:39:57Z INFO cmd_lib::child&lt;span class="o">]&lt;/span> Fatal: can&lt;span class="err">&amp;#39;&lt;/span>t open lock file /run/xtables.lock: Permission denied
&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>rust源码使用
&lt;a
href="https://crates.io/crates/cmd_lib"
>cmd_lib&lt;/a>，编译成&lt;code>std::process&lt;/code>api：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rust" data-lang="rust">&lt;span class="k">fn&lt;/span> &lt;span class="nf">run&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">table&lt;/span>: &lt;span class="kp">&amp;amp;&lt;/span>&lt;span class="kt">str&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">chain&lt;/span>: &lt;span class="kp">&amp;amp;&lt;/span>&lt;span class="kt">str&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>-&amp;gt; &lt;span class="nb">Result&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">run_cmd&lt;/span>&lt;span class="o">!&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">iptables&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">t&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s">&amp;#34;$table&amp;#34;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">D&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">OUTPUT&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">j&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s">&amp;#34;$chain&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div></description></item><item><title>在sudo时如何保持当前环境变量</title><link>https://blog.navyd.xyz/post/2021/09/13/how-to-keep-environment-variables-when-using-sudo/</link><pubDate>Mon, 13 Sep 2021 20:53:59 +0800</pubDate><guid>https://blog.navyd.xyz/post/2021/09/13/how-to-keep-environment-variables-when-using-sudo/</guid><description>&lt;p>在使用sudo时经常出现环境问题，如命令无法找到&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">$ sudo poetry&lt;span class="p">;&lt;/span>sudo sh -c &lt;span class="s1">&amp;#39;echo $VISUAL&amp;#39;&lt;/span>
sudo: poetry: &lt;span class="nb">command&lt;/span> not found
$ which poetry&lt;span class="p">;&lt;/span> &lt;span class="nb">echo&lt;/span> &lt;span class="nv">$VISUAL&lt;/span>
/home/navyd/.local/bin/poetry
vim
&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div></description></item></channel></rss>