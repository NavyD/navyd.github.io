<!doctype html><html lang=zh-cn>
<head>
<meta charset=utf-8>
<meta http-equiv=x-ua-compatible content="IE=edge,chrome=1">
<title> - Even - A super concise theme for Hugo</title>
<meta name=renderer content="webkit">
<meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1">
<meta http-equiv=cache-control content="no-transform">
<meta http-equiv=cache-control content="no-siteapp">
<meta name=theme-color content="#f8f5ec">
<meta name=msapplication-navbutton-color content="#f8f5ec">
<meta name=apple-mobile-web-app-capable content="yes">
<meta name=apple-mobile-web-app-status-bar-style content="#f8f5ec">
<meta name=author content="navyd"><meta name=description content="BeanFactory 简介以及它 和FactoryBean的区别 BeanFacotry是spring中比较原始的Factory。如XMLBeanFactory就是"><meta name=keywords content="Hugo,blog,navyd">
<meta name=generator content="Hugo 0.87.0 with theme even">
<link rel=canonical href=https://navyd.github.io/res/spring/beanfactory-%E5%92%8C-factorybean-%E7%9A%84%E5%8C%BA%E5%88%AB/>
<link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png>
<link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png>
<link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png>
<link rel=manifest href=/manifest.json>
<link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5>
<link href=/sass/main.min.a659bb31b17a54f7792e1bc783fc75b31118e6a175b42337b03fae0b1a3ef2b5.css rel=stylesheet>
<link rel=stylesheet href=https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.css integrity="sha256-7TyXnr2YU040zfSP+rEcz29ggW4j56/ujTPwjMzyqFY=" crossorigin=anonymous>
<meta property="og:title" content>
<meta property="og:description" content="BeanFactory 简介以及它 和FactoryBean的区别 BeanFacotry是spring中比较原始的Factory。如XMLBeanFactory就是">
<meta property="og:type" content="article">
<meta property="og:url" content="https://navyd.github.io/res/spring/beanfactory-%E5%92%8C-factorybean-%E7%9A%84%E5%8C%BA%E5%88%AB/"><meta property="article:section" content="res">
<meta itemprop=name content>
<meta itemprop=description content="BeanFactory 简介以及它 和FactoryBean的区别 BeanFacotry是spring中比较原始的Factory。如XMLBeanFactory就是">
<meta itemprop=wordCount content="5558">
<meta itemprop=keywords content><meta name=twitter:card content="summary">
<meta name=twitter:title content>
<meta name=twitter:description content="BeanFactory 简介以及它 和FactoryBean的区别 BeanFacotry是spring中比较原始的Factory。如XMLBeanFactory就是"><!--[if lte IE 9]><script src=https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js></script><![endif]--><!--[if lt IE 9]><script src=https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js></script>
<script src=https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js></script><![endif]-->
</head>
<body>
<div id=mobile-navbar class=mobile-navbar>
<div class=mobile-header-logo>
<a href=/ class=logo>navyd的个人博客</a>
</div>
<div class=mobile-navbar-icon>
<span></span>
<span></span>
<span></span>
</div>
</div>
<nav id=mobile-menu class="mobile-menu slideout-menu">
<ul class=mobile-menu-list>
<a href=/>
<li class=mobile-menu-item>Home</li>
</a><a href=/post/>
<li class=mobile-menu-item>Archives</li>
</a><a href=/tags/>
<li class=mobile-menu-item>Tags</li>
</a><a href=/categories/>
<li class=mobile-menu-item>Categories</li>
</a>
</ul>
</nav>
<div class=container id=mobile-panel>
<header id=header class=header>
<div class=logo-wrapper>
<a href=/ class=logo>navyd的个人博客</a>
</div>
<nav class=site-navbar>
<ul id=menu class=menu>
<li class=menu-item>
<a class=menu-item-link href=/>Home</a>
</li><li class=menu-item>
<a class=menu-item-link href=/post/>Archives</a>
</li><li class=menu-item>
<a class=menu-item-link href=/tags/>Tags</a>
</li><li class=menu-item>
<a class=menu-item-link href=/categories/>Categories</a>
</li>
</ul>
</nav>
</header>
<main id=main class=main>
<div class=content-wrapper>
<div id=content class=content>
<article class=post>
<div class=post-content>
<h1 id=beanfactory-简介以及它-和factorybean的区别>BeanFactory 简介以及它 和FactoryBean的区别</h1>
<p>BeanFacotry是spring中比较原始的Factory。如XMLBeanFactory就是一种典型的BeanFactory。原始的BeanFactory无法支持spring的许多插件，如AOP功能、Web应用等。</p>
<p>ApplicationContext接口,它由BeanFactory接口派生而来，ApplicationContext包含BeanFactory的所有功能，通常建议比BeanFactory优先</p>
<p><em><strong>BeanFactory和FactoryBean的区别</strong></em></p>
<ul>
<li>BeanFactory是个Factory，也就是IoC容器或对象工厂，FactoryBean是个Bean。在Spring中，所有的Bean都是由BeanFactory(也就是IoC容器)来进行管理的。</li>
</ul>
<p>BeanFactory是接口，提供了IoC容器最基本的形式，给具体的IoC容器的实现提供了规范，</p>
<ul>
<li>FactoryBean这个Bean不是简单的Bean，而是一个能生产或者修饰对象生成的工厂Bean,它的实现与设计模式中的工厂模式和修饰器模式类似</li>
</ul>
<p>FactoryBean也是接口，为IoC容器中Bean的实现提供了更加灵活的方式，FactoryBean在IoC容器的基础上给Bean的实现加上了一个简单工厂模式和装饰模式(如果想了解装饰模式参考：修饰者模式(装饰者模式，Decoration) 我们可以在getObject()方法中灵活配置。其实在Spring源码中有很多FactoryBean的实现类.</p>
<h2 id=beanfactory>BeanFactory</h2>
<p>BeanFactory，以Factory结尾，表示它是一个工厂类(接口)， 它负责生产和管理bean的一个工厂。</p>
<p>在Spring中，BeanFactory是IoC容器的核心接口，它的职责包括：实例化、定位、配置应用程序中的对象及建立这些对象间的依赖。</p>
<p>BeanFactory只是个接口，并不是IoC容器的具体实现，但是Spring容器给出了很多种实现，如 DefaultListableBeanFactory、XmlBeanFactory、ApplicationContext等</p>
<p>其中XmlBeanFactory就是常用的一个，该实现将以XML方式描述组成应用的对象及对象间的依赖关系。XmlBeanFactory类将持有此XML配置元数据，并用它来构建一个完全可配置的系统或应用。</p>
<p>都是附加了某种功能的实现。 它为其他具体的IoC容器提供了最基本的规范，例如DefaultListableBeanFactory,XmlBeanFactory,ApplicationContext 等具体的容器都是实现了BeanFactory，再在其基础之上附加了其他的功能。</p>
<p>BeanFactory和ApplicationContext就是spring框架的两个IoC容器，现在一般使用ApplicationnContext，其不但包含了BeanFactory的作用，同时还进行更多的扩展。</p>
<p>BeanFacotry是spring中比较原始的Factory。如XMLBeanFactory就是一种典型的BeanFactory。
原始的BeanFactory无法支持spring的许多插件，如AOP功能、Web应用等。ApplicationContext接口,它由BeanFactory接口派生而来，</p>
<p>ApplicationContext包含BeanFactory的所有功能，通常建议比BeanFactory优先</p>
<p>ApplicationContext以一种更向面向框架的方式工作以及对上下文进行分层和实现继承，ApplicationContext包还提供了以下的功能：</p>
<ul>
<li>MessageSource, 提供国际化的消息访问</li>
<li>资源访问，如URL和文件</li>
<li>事件传播</li>
<li>载入多个（有继承关系）上下文 ，使得每一个上下文都专注于一个特定的层次，比如应用的web层;</li>
</ul>
<p>在不使用spring框架之前，我们的service层中要使用dao层的对象，不得不在service层中new一个对象。存在的问题：层与层之间的依赖。</p>
<p>service层要用dao层对象需要配置到xml配置文件中，至于对象是怎么创建的，关系是怎么组合的都交给了spring框架去实现。</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=n>Resource</span> <span class=n>resource</span> <span class=o>=</span> <span class=k>new</span> <span class=n>FileSystemResource</span><span class=o>(</span><span class=s>&#34;beans.xml&#34;</span><span class=o>);</span>
<span class=n>BeanFactory</span> <span class=n>factory</span> <span class=o>=</span> <span class=k>new</span> <span class=n>XmlBeanFactory</span><span class=o>(</span><span class=n>resource</span><span class=o>);</span>
<span class=n>ClassPathResource</span> <span class=n>resource</span> <span class=o>=</span> <span class=k>new</span> <span class=n>ClassPathResource</span><span class=o>(</span><span class=s>&#34;beans.xml&#34;</span><span class=o>);</span>
<span class=n>BeanFactory</span> <span class=n>factory</span> <span class=o>=</span> <span class=k>new</span> <span class=n>XmlBeanFactory</span><span class=o>(</span><span class=n>resource</span><span class=o>);</span>
<span class=n>ApplicationContext</span> <span class=n>context</span> <span class=o>=</span> <span class=k>new</span> <span class=n>ClassPathXmlApplicationContext</span><span class=o>(</span><span class=k>new</span> <span class=n>String</span><span class=o>[]</span> <span class=o>{</span><span class=s>&#34;applicationContext.xml&#34;</span><span class=o>,</span> <span class=s>&#34;applicationContext-part2.xml&#34;</span><span class=o>});</span>
<span class=n>BeanFactory</span> <span class=n>factory</span> <span class=o>=</span> <span class=o>(</span><span class=n>BeanFactory</span><span class=o>)</span> <span class=n>context</span><span class=o>;</span>
</code></pre></td></tr></table>
</div>
</div><p>基本就是这些了，接着使用getBean(String beanName)方法就可以取得bean的实例；BeanFactory提供的方法及其简单，仅提供了六种方法供客户调用：</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-java data-lang=java>　　<span class=kt>boolean</span> <span class=nf>containsBean</span><span class=o>(</span><span class=n>String</span> <span class=n>beanName</span><span class=o>)</span> <span class=c1>// 判断工厂中是否包含给定名称的bean定义，若有则返回true
</span><span class=c1></span>　　<span class=n>Object</span> <span class=nf>getBean</span><span class=o>(</span><span class=n>String</span><span class=o>)</span> <span class=c1>// 返回给定名称注册的bean实例。根据bean的配置情况，如果是singleton模式将返回一个共享实例，否则将返回一个新建的实例，如果没有找到指定bean,该方法可能会抛出异常
</span><span class=c1></span>　　<span class=n>Object</span> <span class=nf>getBean</span><span class=o>(</span><span class=n>String</span><span class=o>,</span> <span class=n>Class</span><span class=o>)</span> <span class=c1>// 返回以给定名称注册的bean实例，并转换为给定class类型
</span><span class=c1></span>　　<span class=n>Class</span> <span class=nf>getType</span><span class=o>(</span><span class=n>String</span> <span class=n>name</span><span class=o>)</span> <span class=c1>// 返回给定名称的bean的Class,如果没有找到指定的bean实例，则排除NoSuchBeanDefinitionException异常
</span><span class=c1></span>　　<span class=kt>boolean</span> <span class=nf>isSingleton</span><span class=o>(</span><span class=n>String</span><span class=o>)</span> <span class=c1>// 判断给定名称的bean定义是否为单例模式
</span><span class=c1></span>　　<span class=n>String</span><span class=o>[]</span> <span class=nf>getAliases</span><span class=o>(</span><span class=n>String</span> <span class=n>name</span><span class=o>)</span> <span class=c1>// 返回给定bean名称的所有别名 
</span></code></pre></td></tr></table>
</div>
</div><div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=kn>package</span> <span class=nn>org.springframework.beans.factory</span><span class=o>;</span>  
<span class=kn>import</span> <span class=nn>org.springframework.beans.BeansException</span><span class=o>;</span>  
<span class=kd>public</span> <span class=kd>interface</span> <span class=nc>BeanFactory</span> <span class=o>{</span>  
    <span class=n>String</span> <span class=n>FACTORY_BEAN_PREFIX</span> <span class=o>=</span> <span class=s>&#34;&amp;&#34;</span><span class=o>;</span>  
    <span class=n>Object</span> <span class=nf>getBean</span><span class=o>(</span><span class=n>String</span> <span class=n>name</span><span class=o>)</span> <span class=kd>throws</span> <span class=n>BeansException</span><span class=o>;</span>  
    <span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;</span> <span class=n>T</span> <span class=nf>getBean</span><span class=o>(</span><span class=n>String</span> <span class=n>name</span><span class=o>,</span> <span class=n>Class</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;</span> <span class=n>requiredType</span><span class=o>)</span> <span class=kd>throws</span> <span class=n>BeansException</span><span class=o>;</span>  
    <span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;</span> <span class=n>T</span> <span class=nf>getBean</span><span class=o>(</span><span class=n>Class</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;</span> <span class=n>requiredType</span><span class=o>)</span> <span class=kd>throws</span> <span class=n>BeansException</span><span class=o>;</span>  
    <span class=n>Object</span> <span class=nf>getBean</span><span class=o>(</span><span class=n>String</span> <span class=n>name</span><span class=o>,</span> <span class=n>Object</span><span class=o>...</span> <span class=n>args</span><span class=o>)</span> <span class=kd>throws</span> <span class=n>BeansException</span><span class=o>;</span>  
    <span class=kt>boolean</span> <span class=nf>containsBean</span><span class=o>(</span><span class=n>String</span> <span class=n>name</span><span class=o>);</span>  
    <span class=kt>boolean</span> <span class=nf>isSingleton</span><span class=o>(</span><span class=n>String</span> <span class=n>name</span><span class=o>)</span> <span class=kd>throws</span> <span class=n>NoSuchBeanDefinitionException</span><span class=o>;</span>  
    <span class=kt>boolean</span> <span class=nf>isPrototype</span><span class=o>(</span><span class=n>String</span> <span class=n>name</span><span class=o>)</span> <span class=kd>throws</span> <span class=n>NoSuchBeanDefinitionException</span><span class=o>;</span>  
    <span class=kt>boolean</span> <span class=nf>isTypeMatch</span><span class=o>(</span><span class=n>String</span> <span class=n>name</span><span class=o>,</span> <span class=n>Class</span><span class=o>&lt;?&gt;</span> <span class=n>targetType</span><span class=o>)</span> <span class=kd>throws</span> <span class=n>NoSuchBeanDefinitionException</span><span class=o>;</span>  
    <span class=n>Class</span><span class=o>&lt;?&gt;</span> <span class=n>getType</span><span class=o>(</span><span class=n>String</span> <span class=n>name</span><span class=o>)</span> <span class=kd>throws</span> <span class=n>NoSuchBeanDefinitionException</span><span class=o>;</span>  
    <span class=n>String</span><span class=o>[]</span> <span class=nf>getAliases</span><span class=o>(</span><span class=n>String</span> <span class=n>name</span><span class=o>);</span>  
<span class=o>}</span>  
</code></pre></td></tr></table>
</div>
</div><h2 id=factorybean>FactoryBean</h2>
<p>一般情况下，Spring通过反射机制利用<code>&lt;bean></code>的class属性指定实现类实例化Bean，在某些情况下，实例化Bean过程比较复杂，如果按照传统的方式，则需要在中提供大量的配置信息。</p>
<p>配置方式的灵活性是受限的，这时采用编码的方式可能会得到一个简单的方案。Spring为此提供了一个<code>org.springframework.bean.factory.FactoryBean</code>的工厂类接口，用户可以通过实现该接口定制实例化Bean的逻辑。</p>
<p>FactoryBean接口对于Spring框架来说占用重要的地位，Spring自身就提供了70多个FactoryBean的实现。它们隐藏了实例化一些复杂Bean的细节，给上层应用带来了便利。从Spring3.0开始，FactoryBean开始支持泛型，即接口声明改为<code>FactoryBean&lt;T></code>的形式</p>
<p>以Bean结尾，表示它是一个Bean，不同于普通Bean的是：</p>
<p>它是实现了<code>FactoryBean&lt;T></code>接口的Bean，根据该Bean的ID从BeanFactory中获取的实际上是FactoryBean的getObject()返回的对象，而不是FactoryBean本身，如果要获取FactoryBean对象，请在id前面加一个&符号来获取。</p>
<p>例如自己实现一个FactoryBean，功能：用来代理一个对象，对该对象的所有方法做一个拦截，在调用前后都输出一行LOG，模仿ProxyFactoryBean的功能。</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span><span class=lnt>67
</span><span class=lnt>68
</span><span class=lnt>69
</span><span class=lnt>70
</span><span class=lnt>71
</span><span class=lnt>72
</span><span class=lnt>73
</span><span class=lnt>74
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=cm>/**
</span><span class=cm> * my factory bean&lt;p&gt;
</span><span class=cm> * 代理一个类，拦截该类的所有方法，在方法的调用前后进行日志的输出
</span><span class=cm> * @author daniel.zhao
</span><span class=cm> *
</span><span class=cm> */</span>
<span class=kd>public</span> <span class=kd>class</span> <span class=nc>MyFactoryBean</span> <span class=kd>implements</span> <span class=n>FactoryBean</span><span class=o>&lt;</span><span class=n>Object</span><span class=o>&gt;,</span> <span class=n>InitializingBean</span><span class=o>,</span> <span class=n>DisposableBean</span> <span class=o>{</span>

    <span class=kd>private</span> <span class=kd>static</span> <span class=kd>final</span> <span class=n>Logger</span> <span class=n>logger</span> <span class=o>=</span> <span class=n>LoggerFactory</span><span class=o>.</span><span class=na>getLogger</span><span class=o>(</span><span class=n>MyFactoryBean</span><span class=o>.</span><span class=na>class</span><span class=o>);</span>    
    <span class=kd>private</span> <span class=n>String</span> <span class=n>interfaceName</span><span class=o>;</span>    
    <span class=kd>private</span> <span class=n>Object</span> <span class=n>target</span><span class=o>;</span>    
    <span class=kd>private</span> <span class=n>Object</span> <span class=n>proxyObj</span><span class=o>;</span>    
    <span class=nd>@Override</span>
    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>destroy</span><span class=o>()</span> <span class=kd>throws</span> <span class=n>Exception</span> <span class=o>{</span>
        <span class=n>logger</span><span class=o>.</span><span class=na>debug</span><span class=o>(</span><span class=s>&#34;destroy......&#34;</span><span class=o>);</span>
    <span class=o>}</span>
    <span class=nd>@Override</span>
    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>afterPropertiesSet</span><span class=o>()</span> <span class=kd>throws</span> <span class=n>Exception</span> <span class=o>{</span>
        <span class=n>proxyObj</span> <span class=o>=</span> <span class=n>Proxy</span><span class=o>.</span><span class=na>newProxyInstance</span><span class=o>(</span>
                <span class=k>this</span><span class=o>.</span><span class=na>getClass</span><span class=o>().</span><span class=na>getClassLoader</span><span class=o>(),</span> 
                <span class=k>new</span> <span class=n>Class</span><span class=o>[]</span> <span class=o>{</span> <span class=n>Class</span><span class=o>.</span><span class=na>forName</span><span class=o>(</span><span class=n>interfaceName</span><span class=o>)</span> <span class=o>},</span> 
                <span class=k>new</span> <span class=n>InvocationHandler</span><span class=o>()</span> <span class=o>{</span>                    
            <span class=nd>@Override</span>
            <span class=kd>public</span> <span class=n>Object</span> <span class=nf>invoke</span><span class=o>(</span><span class=n>Object</span> <span class=n>proxy</span><span class=o>,</span> <span class=n>Method</span> <span class=n>method</span><span class=o>,</span> <span class=n>Object</span><span class=o>[]</span> <span class=n>args</span><span class=o>)</span> <span class=kd>throws</span> <span class=n>Throwable</span> <span class=o>{</span>
                <span class=n>logger</span><span class=o>.</span><span class=na>debug</span><span class=o>(</span><span class=s>&#34;invoke method......&#34;</span> <span class=o>+</span> <span class=n>method</span><span class=o>.</span><span class=na>getName</span><span class=o>());</span>
                <span class=n>logger</span><span class=o>.</span><span class=na>debug</span><span class=o>(</span><span class=s>&#34;invoke method before......&#34;</span> <span class=o>+</span> <span class=n>System</span><span class=o>.</span><span class=na>currentTimeMillis</span><span class=o>());</span>
                <span class=n>Object</span> <span class=n>result</span> <span class=o>=</span> <span class=n>method</span><span class=o>.</span><span class=na>invoke</span><span class=o>(</span><span class=n>target</span><span class=o>,</span> <span class=n>args</span><span class=o>);</span>
                <span class=n>logger</span><span class=o>.</span><span class=na>debug</span><span class=o>(</span><span class=s>&#34;invoke method after......&#34;</span> <span class=o>+</span> <span class=n>System</span><span class=o>.</span><span class=na>currentTimeMillis</span><span class=o>());</span>
                <span class=k>return</span> <span class=n>result</span><span class=o>;</span>            <span class=o>}</span>            
        <span class=o>});</span>
        <span class=n>logger</span><span class=o>.</span><span class=na>debug</span><span class=o>(</span><span class=s>&#34;afterPropertiesSet......&#34;</span><span class=o>);</span>
    <span class=o>}</span>

    <span class=nd>@Override</span>
    <span class=kd>public</span> <span class=n>Object</span> <span class=nf>getObject</span><span class=o>()</span> <span class=kd>throws</span> <span class=n>Exception</span> <span class=o>{</span>
        <span class=n>logger</span><span class=o>.</span><span class=na>debug</span><span class=o>(</span><span class=s>&#34;getObject......&#34;</span><span class=o>);</span>
        <span class=k>return</span> <span class=n>proxyObj</span><span class=o>;</span>
    <span class=o>}</span>

    <span class=nd>@Override</span>
    <span class=kd>public</span> <span class=n>Class</span><span class=o>&lt;?&gt;</span> <span class=n>getObjectType</span><span class=o>()</span> <span class=o>{</span>
        <span class=k>return</span> <span class=n>proxyObj</span> <span class=o>==</span> <span class=kc>null</span> <span class=o>?</span> <span class=n>Object</span><span class=o>.</span><span class=na>class</span> <span class=o>:</span> <span class=n>proxyObj</span><span class=o>.</span><span class=na>getClass</span><span class=o>();</span>
    <span class=o>}</span>

    <span class=nd>@Override</span>
    <span class=kd>public</span> <span class=kt>boolean</span> <span class=nf>isSingleton</span><span class=o>()</span> <span class=o>{</span>
        <span class=k>return</span> <span class=kc>true</span><span class=o>;</span>
    <span class=o>}</span>

    <span class=kd>public</span> <span class=n>String</span> <span class=nf>getInterfaceName</span><span class=o>()</span> <span class=o>{</span>
        <span class=k>return</span> <span class=n>interfaceName</span><span class=o>;</span>
    <span class=o>}</span>

    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>setInterfaceName</span><span class=o>(</span><span class=n>String</span> <span class=n>interfaceName</span><span class=o>)</span> <span class=o>{</span>
        <span class=k>this</span><span class=o>.</span><span class=na>interfaceName</span> <span class=o>=</span> <span class=n>interfaceName</span><span class=o>;</span>
    <span class=o>}</span>

    <span class=kd>public</span> <span class=n>Object</span> <span class=nf>getTarget</span><span class=o>()</span> <span class=o>{</span>
        <span class=k>return</span> <span class=n>target</span><span class=o>;</span>
    <span class=o>}</span>

    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>setTarget</span><span class=o>(</span><span class=n>Object</span> <span class=n>target</span><span class=o>)</span> <span class=o>{</span>
        <span class=k>this</span><span class=o>.</span><span class=na>target</span> <span class=o>=</span> <span class=n>target</span><span class=o>;</span>
    <span class=o>}</span>

    <span class=kd>public</span> <span class=n>Object</span> <span class=nf>getProxyObj</span><span class=o>()</span> <span class=o>{</span>
        <span class=k>return</span> <span class=n>proxyObj</span><span class=o>;</span>
    <span class=o>}</span>

    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>setProxyObj</span><span class=o>(</span><span class=n>Object</span> <span class=n>proxyObj</span><span class=o>)</span> <span class=o>{</span>
        <span class=k>this</span><span class=o>.</span><span class=na>proxyObj</span> <span class=o>=</span> <span class=n>proxyObj</span><span class=o>;</span>
    <span class=o>}</span>

<span class=o>}</span>
</code></pre></td></tr></table>
</div>
</div><p>XML-Bean配置如下</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-xml data-lang=xml>
1 <span class=nt>&lt;bean</span> <span class=na>id=</span><span class=s>&#34;fbHelloWorldService&#34;</span> <span class=na>class=</span><span class=s>&#34;com.ebao.xxx.MyFactoryBean&#34;</span><span class=nt>&gt;</span>
2     <span class=nt>&lt;property</span> <span class=na>name=</span><span class=s>&#34;interfaceName&#34;</span> <span class=na>value=</span><span class=s>&#34;com.ebao.xxx.HelloWorldService&#34;</span> <span class=nt>/&gt;</span>
3     <span class=nt>&lt;property</span> <span class=na>name=</span><span class=s>&#34;target&#34;</span> <span class=na>ref=</span><span class=s>&#34;helloWorldService&#34;</span> <span class=nt>/&gt;</span>
4 <span class=nt>&lt;/bean&gt;</span>
</code></pre></td></tr></table>
</div>
</div><p>Junit Test class</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=nd>@RunWith</span><span class=o>(</span><span class=n>JUnit4ClassRunner</span><span class=o>.</span><span class=na>class</span><span class=o>)</span>
<span class=nd>@ContextConfiguration</span><span class=o>(</span><span class=n>classes</span> <span class=o>=</span> <span class=o>{</span> <span class=n>MyFactoryBeanConfig</span><span class=o>.</span><span class=na>class</span> <span class=o>})</span>
<span class=kd>public</span> <span class=kd>class</span> <span class=nc>MyFactoryBeanTest</span> <span class=o>{</span>
    <span class=nd>@Autowired</span>
    <span class=kd>private</span> <span class=n>ApplicationContext</span> <span class=n>context</span><span class=o>;</span>    
    <span class=cm>/**
</span><span class=cm>     * 测试验证FactoryBean原理，代理一个servcie在调用其方法的前后，打印日志亦可作其他处理
</span><span class=cm>     * 从ApplicationContext中获取自定义的FactoryBean
</span><span class=cm>     * context.getBean(String beanName) ---&gt; 最终获取到的Object是FactoryBean.getObejct(), 
</span><span class=cm>     * 使用Proxy.newInstance生成service的代理类
</span><span class=cm>     */</span>
    <span class=nd>@Test</span>
    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>testFactoryBean</span><span class=o>()</span> <span class=o>{</span>
        <span class=n>HelloWorldService</span> <span class=n>helloWorldService</span> <span class=o>=</span> <span class=o>(</span><span class=n>HelloWorldService</span><span class=o>)</span> <span class=n>context</span><span class=o>.</span><span class=na>getBean</span><span class=o>(</span><span class=s>&#34;fbHelloWorldService&#34;</span><span class=o>);</span>
        <span class=n>helloWorldService</span><span class=o>.</span><span class=na>getBeanName</span><span class=o>();</span>
        <span class=n>helloWorldService</span><span class=o>.</span><span class=na>sayHello</span><span class=o>();</span>
    <span class=o>}</span>
<span class=o>}</span>
</code></pre></td></tr></table>
</div>
</div><p>FactoryBean是一个接口，当在IoC容器中的Bean实现了FactoryBean后，通过getBean(String BeanName)获取到的Bean对象并不是FactoryBean的实现类对象，而是这个实现类中的getObject()方法返回的对象。要想获取FactoryBean的实现类，就要getBean(&BeanName)，在BeanName之前加上&。</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=kn>package</span> <span class=nn>org.springframework.beans.factory</span><span class=o>;</span>  
<span class=kd>public</span> <span class=kd>interface</span> <span class=nc>FactoryBean</span> <span class=o>{</span>  
    <span class=n>T</span> <span class=nf>getObject</span><span class=o>()</span> <span class=kd>throws</span> <span class=n>Exception</span><span class=o>;</span>  
    <span class=n>Class</span><span class=o>&lt;?&gt;</span> <span class=n>getObjectType</span><span class=o>();</span>  
    <span class=kt>boolean</span> <span class=nf>isSingleton</span><span class=o>();</span>  
<span class=o>}</span>   
</code></pre></td></tr></table>
</div>
</div><p>在该接口中还定义了以下3个方法：</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=n>T</span> <span class=nf>getObject</span><span class=o>()</span> <span class=c1>// 返回由FactoryBean创建的Bean实例，如果isSingleton()返回true，则该实例会放到Spring容器中单实例缓存池中；
</span><span class=c1></span><span class=kt>boolean</span> <span class=nf>isSingleton</span><span class=o>()</span> <span class=c1>// 返回由FactoryBean创建的Bean实例的作用域是singleton还是prototype；
</span><span class=c1></span><span class=n>Class</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;</span> <span class=nf>getObjectType</span><span class=o>()</span> <span class=c1>// 返回FactoryBean创建的Bean类型。
</span></code></pre></td></tr></table>
</div>
</div><p>当配置文件中<code>&lt;bean></code>的class属性配置的实现类是FactoryBean时，通过getBean()方法返回的不是FactoryBean本身，而是FactoryBean#getObject()方法所返回的对象，相当于FactoryBean#getObject()代理了getBean()方法。</p>
<p>例：如果使用传统方式配置下面Car的<code>&lt;bean></code>时，Car的每个属性分别对应一个<code>&lt;property></code>元素标签。</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=kn>package</span>  <span class=nn>com.baobaotao.factorybean</span><span class=o>;</span>  
    <span class=kd>public</span>   <span class=kd>class</span>  <span class=nc>Car</span>  <span class=o>{</span>  
        <span class=kd>private</span>   <span class=kt>int</span> <span class=n>maxSpeed</span> <span class=o>;</span>  
        <span class=kd>private</span>  <span class=n>String</span> <span class=n>brand</span> <span class=o>;</span>  
        <span class=kd>private</span>   <span class=kt>double</span> <span class=n>price</span> <span class=o>;</span>  
        <span class=kd>public</span>   <span class=kt>int</span>  <span class=nf>getMaxSpeed</span> <span class=o>()</span>   <span class=o>{</span>  
            <span class=k>return</span>   <span class=k>this</span> <span class=o>.</span> <span class=n>maxSpeed</span> <span class=o>;</span>  
        <span class=o>}</span>  
        <span class=kd>public</span>   <span class=kt>void</span>  <span class=nf>setMaxSpeed</span> <span class=o>(</span> <span class=kt>int</span>  <span class=n>maxSpeed</span> <span class=o>)</span>   <span class=o>{</span>  
            <span class=k>this</span> <span class=o>.</span> <span class=n>maxSpeed</span>  <span class=o>=</span> <span class=n>maxSpeed</span><span class=o>;</span>  
        <span class=o>}</span>  
        <span class=kd>public</span>  <span class=n>String</span> <span class=nf>getBrand</span> <span class=o>()</span>   <span class=o>{</span>  
            <span class=k>return</span>   <span class=k>this</span> <span class=o>.</span> <span class=n>brand</span> <span class=o>;</span>  
        <span class=o>}</span>  
        <span class=kd>public</span>   <span class=kt>void</span>  <span class=nf>setBrand</span> <span class=o>(</span> <span class=n>String</span> <span class=n>brand</span> <span class=o>)</span>   <span class=o>{</span>  
            <span class=k>this</span> <span class=o>.</span> <span class=n>brand</span>  <span class=o>=</span> <span class=n>brand</span><span class=o>;</span>  
        <span class=o>}</span>  
        <span class=kd>public</span>   <span class=kt>double</span>  <span class=nf>getPrice</span> <span class=o>()</span>   <span class=o>{</span>  
            <span class=k>return</span>   <span class=k>this</span> <span class=o>.</span> <span class=n>price</span> <span class=o>;</span>  
        <span class=o>}</span>  
        <span class=kd>public</span>   <span class=kt>void</span>  <span class=nf>setPrice</span> <span class=o>(</span> <span class=kt>double</span>  <span class=n>price</span> <span class=o>)</span>   <span class=o>{</span>  
            <span class=k>this</span> <span class=o>.</span> <span class=n>price</span>  <span class=o>=</span> <span class=n>price</span><span class=o>;</span>  
       <span class=o>}</span>  
<span class=o>}</span>   
</code></pre></td></tr></table>
</div>
</div><p>如果用FactoryBean的方式实现就灵活点，下例通过逗号分割符的方式一次性的为Car的所有属性指定配置值：</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=kn>package</span>  <span class=nn>com.baobaotao.factorybean</span><span class=o>;</span>  
<span class=kn>import</span>  <span class=nn>org.springframework.beans.factory.FactoryBean</span><span class=o>;</span>  
<span class=kd>public</span>   <span class=kd>class</span>  <span class=nc>CarFactoryBean</span>  <span class=kd>implements</span>  <span class=n>FactoryBean</span>  <span class=o>{</span>  
    <span class=kd>private</span>  <span class=n>String</span> <span class=n>carInfo</span> <span class=o>;</span>  
    <span class=kd>public</span>  <span class=n>Car</span> <span class=nf>getObject</span> <span class=o>()</span>   <span class=kd>throws</span>  <span class=n>Exception</span>  <span class=o>{</span>  
        <span class=n>Car</span> <span class=n>car</span> <span class=o>=</span>  <span class=k>new</span>  <span class=n>Car</span> <span class=o>()</span> <span class=o>;</span>  
        <span class=n>String</span> <span class=o>[]</span>  <span class=n>infos</span> <span class=o>=</span>  <span class=n>carInfo</span> <span class=o>.</span><span class=na>split</span> <span class=o>(</span> <span class=s>&#34;,&#34;</span> <span class=o>)</span> <span class=o>;</span>  
        <span class=n>car</span><span class=o>.</span><span class=na>setBrand</span> <span class=o>(</span> <span class=n>infos</span> <span class=o>[</span> <span class=n>0</span> <span class=o>])</span> <span class=o>;</span>  
        <span class=n>car</span><span class=o>.</span><span class=na>setMaxSpeed</span> <span class=o>(</span> <span class=n>Integer</span><span class=o>.</span> <span class=nf>valueOf</span> <span class=o>(</span> <span class=n>infos</span> <span class=o>[</span> <span class=n>1</span> <span class=o>]))</span> <span class=o>;</span>  
        <span class=n>car</span><span class=o>.</span><span class=na>setPrice</span> <span class=o>(</span> <span class=n>Double</span><span class=o>.</span> <span class=nf>valueOf</span> <span class=o>(</span> <span class=n>infos</span> <span class=o>[</span> <span class=n>2</span> <span class=o>]))</span> <span class=o>;</span>  
        <span class=k>return</span>  <span class=n>car</span><span class=o>;</span>  
    <span class=o>}</span>  
    <span class=kd>public</span>  <span class=n>Class</span><span class=o>&lt;</span><span class=n>Car</span><span class=o>&gt;</span> <span class=nf>getObjectType</span> <span class=o>()</span>   <span class=o>{</span>  
        <span class=k>return</span>  <span class=n>Car</span><span class=o>.</span> <span class=kd>class</span> <span class=err>;  </span>
    <span class=o>}</span>  
    <span class=kd>public</span>   <span class=kt>boolean</span>  <span class=nf>isSingleton</span> <span class=o>()</span>   <span class=o>{</span>  
        <span class=k>return</span>   <span class=kc>false</span> <span class=o>;</span>  
    <span class=o>}</span>  
    <span class=kd>public</span>  <span class=n>String</span> <span class=nf>getCarInfo</span> <span class=o>()</span>   <span class=o>{</span>  
        <span class=k>return</span>   <span class=k>this</span> <span class=o>.</span> <span class=n>carInfo</span> <span class=o>;</span>  
    <span class=o>}</span>  
  
    <span class=c1>// 接受逗号分割符设置属性信息  
</span><span class=c1></span>    <span class=kd>public</span>   <span class=kt>void</span>  <span class=nf>setCarInfo</span> <span class=o>(</span> <span class=n>String</span> <span class=n>carInfo</span> <span class=o>)</span>   <span class=o>{</span>  
        <span class=k>this</span> <span class=o>.</span> <span class=n>carInfo</span>  <span class=o>=</span> <span class=n>carInfo</span><span class=o>;</span>  
    <span class=o>}</span>  
<span class=o>}</span>   
</code></pre></td></tr></table>
</div>
</div><p>有了这个CarFactoryBean后，就可以在配置文件中使用下面这种自定义的配置方式配置CarBean了：</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-xml data-lang=xml><span class=nt>&lt;bean</span> <span class=na>id=</span><span class=s>&#34;car&#34;</span><span class=na>class=</span><span class=s>&#34;com.baobaotao.factorybean.CarFactoryBean&#34;</span> <span class=na>P:carInfo=</span><span class=s>&#34;法拉利,400,2000000&#34;</span><span class=nt>/&gt;</span>
</code></pre></td></tr></table>
</div>
</div><p>当调用getBean(&ldquo;car&rdquo;)时，Spring通过反射机制发现CarFactoryBean实现了FactoryBean的接口，这时Spring容器就调用接口方法<code>CarFactoryBean#getObject()</code>方法返回。</p>
<p>如果希望获取CarFactoryBean的实例，则需要在使用getBean(beanName)方法时在beanName前显示的加上"&&ldquo;前缀：如getBean("&car&rdquo;);</p>
<p>下面是一个应用FactoryBean的例子</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-xml data-lang=xml><span class=nt>&lt;beans</span> <span class=na>xmlns=</span><span class=s>&#34;http://www.springframework.org/schema/beans&#34;</span>  
             <span class=na>xmlns:xsi=</span><span class=s>&#34;http://www.w3.org/2001/XMLSchema-instance&#34;</span>  
             <span class=na>xmlns:context=</span><span class=s>&#34;http://www.springframework.org/schema/context&#34;</span>  
             <span class=na>xmlns:aop=</span><span class=s>&#34;http://www.springframework.org/schema/aop&#34;</span>  
             <span class=na>xmlns:tx=</span><span class=s>&#34;http://www.springframework.org/schema/tx&#34;</span>  
             <span class=na>xsi:schemaLocation=</span><span class=s>&#34;http://www.springframework.org/schema/beans  
</span><span class=s>                     http://www.springframework.org/schema/beans/spring-beans-3.0.xsd  
</span><span class=s>                     http://www.springframework.org/schema/context  
</span><span class=s>                     http://www.springframework.org/schema/context/spring-context-3.0.xsd  
</span><span class=s>                     http://www.springframework.org/schema/aop  
</span><span class=s>                     http://www.springframework.org/schema/aop/spring-aop-3.0.xsd  
</span><span class=s>                     http://www.springframework.org/schema/tx  
</span><span class=s>                     http://&#34;</span><span class=nt>&gt;</span>www.springframework.org/schema/tx/spring-tx-3.0.xsd&#34;&gt;  
      
 <span class=nt>&lt;bean</span> <span class=na>id=</span><span class=s>&#34;student&#34;</span> <span class=na>class=</span><span class=s>&#34;com.spring.bean.Student&#34;</span><span class=nt>&gt;</span>    
  <span class=nt>&lt;property</span> <span class=na>name=</span><span class=s>&#34;name&#34;</span> <span class=na>value=</span><span class=s>&#34;zhangsan&#34;</span> <span class=nt>/&gt;</span>    
 <span class=nt>&lt;/bean&gt;</span>    
   
 <span class=nt>&lt;bean</span> <span class=na>id=</span><span class=s>&#34;school&#34;</span> <span class=na>class=</span><span class=s>&#34;com.spring.bean.School&#34;</span><span class=nt>&gt;</span>    
 <span class=nt>&lt;/bean&gt;</span>   
   
 <span class=nt>&lt;bean</span> <span class=na>id=</span><span class=s>&#34;factoryBeanPojo&#34;</span> <span class=na>class=</span><span class=s>&#34;com.spring.bean.FactoryBeanPojo&#34;</span><span class=nt>&gt;</span>    
    <span class=nt>&lt;property</span> <span class=na>name=</span><span class=s>&#34;type&#34;</span> <span class=na>value=</span><span class=s>&#34;student&#34;</span> <span class=nt>/&gt;</span>  
 <span class=nt>&lt;/bean&gt;</span>   
<span class=nt>&lt;/beans&gt;</span>    
</code></pre></td></tr></table>
</div>
</div><p>FactoryBean的实现类</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=kn>import</span> <span class=nn>org.springframework.beans.factory.FactoryBean</span><span class=o>;</span>  
  
<span class=cm>/**  
</span><span class=cm> * @author  作者 wangbiao 
</span><span class=cm> * @date 创建时间：2016年11月14日 上午11:19:31  
</span><span class=cm> * @parameter  
</span><span class=cm> * @return  
</span><span class=cm> */</span>  
<span class=kd>public</span> <span class=kd>class</span> <span class=nc>FactoryBeanPojo</span> <span class=kd>implements</span> <span class=n>FactoryBean</span><span class=o>{</span>  
    <span class=kd>private</span> <span class=n>String</span> <span class=n>type</span><span class=o>;</span>  
  
    <span class=nd>@Override</span>  
    <span class=kd>public</span> <span class=n>Object</span> <span class=nf>getObject</span><span class=o>()</span> <span class=kd>throws</span> <span class=n>Exception</span> <span class=o>{</span>  
        <span class=k>if</span><span class=o>(</span><span class=s>&#34;student&#34;</span><span class=o>.</span><span class=na>equals</span><span class=o>(</span><span class=n>type</span><span class=o>)){</span>  
            <span class=k>return</span> <span class=k>new</span> <span class=n>Student</span><span class=o>();</span>             
        <span class=o>}</span><span class=k>else</span><span class=o>{</span>  
            <span class=k>return</span> <span class=k>new</span> <span class=n>School</span><span class=o>();</span>  
        <span class=o>}</span>  
          
    <span class=o>}</span>  
  
    <span class=nd>@Override</span>  
    <span class=kd>public</span> <span class=n>Class</span> <span class=nf>getObjectType</span><span class=o>()</span> <span class=o>{</span>  
        <span class=k>return</span> <span class=n>School</span><span class=o>.</span><span class=na>class</span><span class=o>;</span>  
    <span class=o>}</span>  
  
    <span class=nd>@Override</span>  
    <span class=kd>public</span> <span class=kt>boolean</span> <span class=nf>isSingleton</span><span class=o>()</span> <span class=o>{</span>  
        <span class=k>return</span> <span class=kc>true</span><span class=o>;</span>  
    <span class=o>}</span>  
  
    <span class=kd>public</span> <span class=n>String</span> <span class=nf>getType</span><span class=o>()</span> <span class=o>{</span>  
        <span class=k>return</span> <span class=n>type</span><span class=o>;</span>  
    <span class=o>}</span>  
  
    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>setType</span><span class=o>(</span><span class=n>String</span> <span class=n>type</span><span class=o>)</span> <span class=o>{</span>  
        <span class=k>this</span><span class=o>.</span><span class=na>type</span> <span class=o>=</span> <span class=n>type</span><span class=o>;</span>  
    <span class=o>}</span>  
      
<span class=o>}</span>  
</code></pre></td></tr></table>
</div>
</div><p>普通的bean</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=cm>/**  
</span><span class=cm> * @author  作者 wangbiao 
</span><span class=cm> * @date 创建时间：2016年11月14日 上午11:13:18  
</span><span class=cm> * @parameter  
</span><span class=cm> * @return  
</span><span class=cm> */</span>  
<span class=kd>public</span> <span class=kd>class</span> <span class=nc>School</span> <span class=o>{</span>  
    <span class=kd>private</span> <span class=n>String</span> <span class=n>schoolName</span><span class=o>;</span>  
    <span class=kd>private</span> <span class=n>String</span> <span class=n>address</span><span class=o>;</span>  
    <span class=kd>private</span> <span class=kt>int</span> <span class=n>studentNumber</span><span class=o>;</span>  
    <span class=kd>public</span> <span class=n>String</span> <span class=nf>getSchoolName</span><span class=o>()</span> <span class=o>{</span>  
        <span class=k>return</span> <span class=n>schoolName</span><span class=o>;</span>  
    <span class=o>}</span>  
    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>setSchoolName</span><span class=o>(</span><span class=n>String</span> <span class=n>schoolName</span><span class=o>)</span> <span class=o>{</span>  
        <span class=k>this</span><span class=o>.</span><span class=na>schoolName</span> <span class=o>=</span> <span class=n>schoolName</span><span class=o>;</span>  
    <span class=o>}</span>  
    <span class=kd>public</span> <span class=n>String</span> <span class=nf>getAddress</span><span class=o>()</span> <span class=o>{</span>  
        <span class=k>return</span> <span class=n>address</span><span class=o>;</span>  
    <span class=o>}</span>  
    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>setAddress</span><span class=o>(</span><span class=n>String</span> <span class=n>address</span><span class=o>)</span> <span class=o>{</span>  
        <span class=k>this</span><span class=o>.</span><span class=na>address</span> <span class=o>=</span> <span class=n>address</span><span class=o>;</span>  
    <span class=o>}</span>  
    <span class=kd>public</span> <span class=kt>int</span> <span class=nf>getStudentNumber</span><span class=o>()</span> <span class=o>{</span>  
        <span class=k>return</span> <span class=n>studentNumber</span><span class=o>;</span>  
    <span class=o>}</span>  
    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>setStudentNumber</span><span class=o>(</span><span class=kt>int</span> <span class=n>studentNumber</span><span class=o>)</span> <span class=o>{</span>  
        <span class=k>this</span><span class=o>.</span><span class=na>studentNumber</span> <span class=o>=</span> <span class=n>studentNumber</span><span class=o>;</span>  
    <span class=o>}</span>  
    <span class=nd>@Override</span>  
    <span class=kd>public</span> <span class=n>String</span> <span class=nf>toString</span><span class=o>()</span> <span class=o>{</span>  
        <span class=k>return</span> <span class=s>&#34;School [schoolName=&#34;</span> <span class=o>+</span> <span class=n>schoolName</span> <span class=o>+</span> <span class=s>&#34;, address=&#34;</span> <span class=o>+</span> <span class=n>address</span>  
                <span class=o>+</span> <span class=s>&#34;, studentNumber=&#34;</span> <span class=o>+</span> <span class=n>studentNumber</span> <span class=o>+</span> <span class=s>&#34;]&#34;</span><span class=o>;</span>  
    <span class=o>}</span>  
<span class=o>}</span>  
</code></pre></td></tr></table>
</div>
</div><p>测试类</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=kn>import</span> <span class=nn>org.springframework.context.support.ClassPathXmlApplicationContext</span><span class=o>;</span>  
  
<span class=kn>import</span> <span class=nn>com.spring.bean.FactoryBeanPojo</span><span class=o>;</span>  
  
<span class=cm>/**  
</span><span class=cm> * @author  作者 wangbiao 
</span><span class=cm> * @date 创建时间：2016年11月14日 上午11:11:35  
</span><span class=cm> * @parameter  
</span><span class=cm> * @return  
</span><span class=cm> */</span>  
<span class=kd>public</span> <span class=kd>class</span> <span class=nc>FactoryBeanTest</span> <span class=o>{</span>  
    <span class=kd>public</span> <span class=kd>static</span> <span class=kt>void</span> <span class=nf>main</span><span class=o>(</span><span class=n>String</span><span class=o>[]</span> <span class=n>args</span><span class=o>){</span>  
        <span class=n>String</span> <span class=n>url</span> <span class=o>=</span> <span class=s>&#34;com/spring/config/BeanConfig.xml&#34;</span><span class=o>;</span>  
        <span class=n>ClassPathXmlApplicationContext</span> <span class=n>cpxa</span> <span class=o>=</span> <span class=k>new</span> <span class=n>ClassPathXmlApplicationContext</span><span class=o>(</span><span class=n>url</span><span class=o>);</span>  
        <span class=n>Object</span> <span class=n>school</span><span class=o>=</span>  <span class=n>cpxa</span><span class=o>.</span><span class=na>getBean</span><span class=o>(</span><span class=s>&#34;factoryBeanPojo&#34;</span><span class=o>);</span>  
        <span class=n>FactoryBeanPojo</span> <span class=n>factoryBeanPojo</span><span class=o>=</span> <span class=o>(</span><span class=n>FactoryBeanPojo</span><span class=o>)</span> <span class=n>cpxa</span><span class=o>.</span><span class=na>getBean</span><span class=o>(</span><span class=s>&#34;&amp;factoryBeanPojo&#34;</span><span class=o>);</span>  
        <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=n>school</span><span class=o>.</span><span class=na>getClass</span><span class=o>().</span><span class=na>getName</span><span class=o>());</span>  
        <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=n>factoryBeanPojo</span><span class=o>.</span><span class=na>getClass</span><span class=o>().</span><span class=na>getName</span><span class=o>());</span>  
    <span class=o>}</span>  
<span class=o>}</span>  
</code></pre></td></tr></table>
</div>
</div><p>输出的结果：</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback>十一月 16, 2016 10:28:24 上午 org.springframework.context.support.AbstractApplicationContext prepareRefresh  
INFO: Refreshing org.springframework.context.support.ClassPathXmlApplicationContext@1e8ee5c0: startup date [Wed Nov 16 10:28:24 CST 2016]; root of context hierarchy  
十一月 16, 2016 10:28:24 上午 org.springframework.beans.factory.xml.XmlBeanDefinitionReader loadBeanDefinitions  
INFO: Loading XML bean definitions from class path resource [com/spring/config/BeanConfig.xml]  
十一月 16, 2016 10:28:24 上午 org.springframework.beans.factory.support.DefaultListableBeanFactory preInstantiateSingletons  
INFO: Pre-instantiating singletons in org.springframework.beans.factory.support.DefaultListableBeanFactory@35b793ee: defining beans [student,school,factoryBeanPojo]; root of factory hierarchy  
com.spring.bean.Student  
com.spring.bean.FactoryBeanPojo  
</code></pre></td></tr></table>
</div>
</div><p>从结果上可以看到当从IoC容器中获取FactoryBeanPojo对象的时候，用getBean(String BeanName)获取的确是Student对象，可以看到在FactoryBeanPojo中的type属性设置为student的时候，会在getObject()方法中返回Student对象。</p>
<p>所以说从IoC容器获取实现了FactoryBean的实现类时，返回的却是实现类中的getObject方法返回的对象，要想获取FactoryBean的实现类，得在getBean(String BeanName)中的BeanName之前加上&,写成getBean(String &BeanName)</p>
<p>参考</p>
<ul>
<li><a test href=https://www.cnblogs.com/aspirant/p/9082858.html>BeanFactory 简介以及它 和FactoryBean的区别(阿里面试)</a></li>
<li><a test href=https://www.jianshu.com/p/2feec33afaa0>BeanFactory 和 FactoryBean 的区别</a></li>
</ul>
</div>
</article>
</div>
</div>
</main>
<footer id=footer class=footer>
<div class=social-links>
<a href=https://github.com/NavyD/navyd.github.io class="iconfont icon-github" title=github></a>
<a href=https://navyd.github.io/index.xml type=application/rss+xml class="iconfont icon-rss" title=rss></a>
</div>
<div class=copyright>
<span class=power-by>
由 <a class=hexo-link href=https://gohugo.io>Hugo</a> 强力驱动
</span>
<span class=division>|</span>
<span class=theme-info>
主题 -
<a class=theme-link href=https://github.com/olOwOlo/hugo-theme-even>Even</a>
</span>
<span class=copyright-year>
&copy;
2021<span class=heart><i class="iconfont icon-heart"></i></span><span>navyd</span>
</span>
</div>
</footer>
<div class=back-to-top id=back-to-top>
<i class="iconfont icon-up"></i>
</div>
</div>
<script src=https://cdn.jsdelivr.net/npm/jquery@3.2.1/dist/jquery.min.js integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin=anonymous></script>
<script src=https://cdn.jsdelivr.net/npm/slideout@1.0.1/dist/slideout.min.js integrity="sha256-t+zJ/g8/KXIJMjSVQdnibt4dlaDxc9zXr/9oNPeWqdg=" crossorigin=anonymous></script>
<script src=https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.js integrity="sha256-XVLffZaxoWfGUEbdzuLi7pwaUJv1cecsQJQqGLe7axY=" crossorigin=anonymous></script>
<script src=https://cdn.jsdelivr.net/npm/timeago.js@3.0.2/dist/timeago.min.js integrity="sha256-jwCP0NAdCBloaIWTWHmW4i3snUNMHUNO+jr9rYd2iOI=" crossorigin=anonymous></script>
<script src=https://cdn.jsdelivr.net/npm/timeago.js@3.0.2/dist/timeago.locales.min.js integrity="sha256-ZwofwC1Lf/faQCzN7nZtfijVV6hSwxjQMwXL4gn9qU8=" crossorigin=anonymous></script>
<script>var languageCode="en".replace(/-/g,'_').replace(/_(.*)/,function(b,a){return b.replace(a,a.toUpperCase())});timeago().render(document.querySelectorAll('.timeago'),languageCode),timeago.cancel()</script>
<script type=text/javascript src=/js/main.min.c99b103c33d1539acf3025e1913697534542c4a5aa5af0ccc20475ed2863603b.js></script>
</body>
</html>